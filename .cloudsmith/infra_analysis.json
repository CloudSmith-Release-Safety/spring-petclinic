{
  "org_name": "CloudSmith-Release-Safety",
  "repo_name": "spring-petclinic",
  "repo_url": "https://github.com/CloudSmith-Release-Safety/spring-petclinic",
  "infrastructure_providers": [
    {
      "provider_id": "kinesis_data_stream",
      "resource_type": "Kinesis",
      "resource_identifier": "apm_test",
      "file_path": "spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/aws/KinesisService.java",
      "infrastructure_type": "SDK-Direct",
      "description": "Kinesis data stream for application performance monitoring and event data collection",
      "interfaces": [
        {
          "interface_type": "stream",
          "endpoint_pattern": "kinesis.${region}.amazonaws.com",
          "operations": ["CreateStream", "DescribeStream", "GetShardIterator", "GetRecords"],
          "authentication": "IAM"
        }
      ],
      "configuration": {
        "stream_name": "apm_test",
        "shard_count": 1
      },
      "provider_type": "internal"
    },
    {
      "provider_id": "sqs_queue",
      "resource_type": "SQS",
      "resource_identifier": "apm_test",
      "file_path": "spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/aws/SqsService.java",
      "infrastructure_type": "SDK-Direct",
      "description": "SQS queue for performance monitoring and asynchronous processing",
      "interfaces": [
        {
          "interface_type": "queue",
          "endpoint_pattern": "sqs.${region}.amazonaws.com",
          "operations": ["CreateQueue", "GetQueueUrl", "SendMessage", "PurgeQueue"],
          "authentication": "IAM"
        }
      ],
      "configuration": {
        "queue_name": "apm_test",
        "message_retention_seconds": 345600
      },
      "provider_type": "internal"
    },
    {
      "provider_id": "bedrock_runtime",
      "resource_type": "Bedrock",
      "resource_identifier": "amazon.titan-text-express-v1",
      "file_path": "spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/aws/BedrockRuntimeV1Service.java",
      "infrastructure_type": "SDK-Direct",
      "description": "Amazon Bedrock AI model for generating pet disease information",
      "interfaces": [
        {
          "interface_type": "api",
          "endpoint_pattern": "bedrock-runtime.${region}.amazonaws.com",
          "operations": ["InvokeModel"],
          "authentication": "IAM"
        }
      ],
      "configuration": {
        "model_id": "amazon.titan-text-express-v1",
        "temperature": 0.8,
        "top_p": 0.9,
        "max_token_count": 1000
      },
      "provider_type": "external"
    },
    {
      "provider_id": "bedrock_runtime_claude",
      "resource_type": "Bedrock",
      "resource_identifier": "anthropic.claude-3-sonnet-20240229-v1:0",
      "file_path": "spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/aws/BedrockRuntimeV2Service.java",
      "infrastructure_type": "SDK-Direct",
      "description": "Anthropic Claude AI model for pet health-related information",
      "interfaces": [
        {
          "interface_type": "api",
          "endpoint_pattern": "bedrock-runtime.${region}.amazonaws.com",
          "operations": ["InvokeModel"],
          "authentication": "IAM"
        }
      ],
      "configuration": {
        "model_id": "anthropic.claude-3-sonnet-20240229-v1:0"
      },
      "provider_type": "external"
    },
    {
      "provider_id": "bedrock_kb",
      "resource_type": "Bedrock",
      "resource_identifier": "${knowledge_base_id}",
      "file_path": "spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/aws/BedrockAgentV1Service.java",
      "infrastructure_type": "SDK-Direct",
      "description": "Amazon Bedrock Knowledge Base for accessing veterinary knowledge",
      "interfaces": [
        {
          "interface_type": "api",
          "endpoint_pattern": "bedrock.${region}.amazonaws.com",
          "operations": ["GetKnowledgeBase"],
          "authentication": "IAM"
        }
      ],
      "configuration": {},
      "provider_type": "external"
    },
    {
      "provider_id": "bedrock_guardrails",
      "resource_type": "Bedrock",
      "resource_identifier": "${guardrail_id}",
      "file_path": "spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/aws/BedrockV1Service.java",
      "infrastructure_type": "SDK-Direct",
      "description": "Amazon Bedrock Guardrails for content moderation",
      "interfaces": [
        {
          "interface_type": "api",
          "endpoint_pattern": "bedrock.${region}.amazonaws.com",
          "operations": ["GetGuardrail"],
          "authentication": "IAM"
        }
      ],
      "configuration": {},
      "provider_type": "external"
    },
    {
      "provider_id": "s3_bucket",
      "resource_type": "S3",
      "resource_identifier": "${trace_data_bucket}",
      "file_path": "spring-petclinic-vets-service/src/main/java/org/springframework/samples/petclinic/vets/aws/S3Service.java",
      "infrastructure_type": "SDK-Direct",
      "description": "S3 bucket for storing trace data and monitoring information",
      "interfaces": [
        {
          "interface_type": "storage",
          "endpoint_pattern": "s3.amazonaws.com/${trace_data_bucket}",
          "operations": ["ListBuckets"],
          "authentication": "IAM"
        }
      ],
      "configuration": {
        "region": "us-east-1"
      },
      "environment_variables": ["TRACE_DATA_BUCKET", "TRACE_DATA_S3_KEY"],
      "provider_type": "external"
    },
    {
      "provider_id": "dynamodb_table",
      "resource_type": "DynamoDB",
      "resource_identifier": "apm_test",
      "file_path": "spring-petclinic-visits-service/src/main/java/org/springframework/samples/petclinic/visits/aws/DdbService.java",
      "infrastructure_type": "SDK-Direct",
      "description": "DynamoDB table for storing application monitoring data",
      "interfaces": [
        {
          "interface_type": "database",
          "endpoint_pattern": "dynamodb.${region}.amazonaws.com",
          "operations": ["CreateTable", "DescribeTable", "PutItem"],
          "authentication": "IAM"
        }
      ],
      "configuration": {
        "table_name": "apm_test",
        "key_schema": [
          {
            "attribute_name": "id",
            "key_type": "HASH"
          }
        ],
        "provisioned_throughput": {
          "read_capacity_units": 1,
          "write_capacity_units": 1
        }
      },
      "provider_type": "internal"
    },
    {
      "provider_id": "eks_cluster",
      "resource_type": "EKS",
      "resource_identifier": "${cluster_name}",
      "file_path": "scripts/eks/appsignals/sample-app/customers-service-deployment.yaml",
      "infrastructure_type": "SDK-Direct",
      "description": "Amazon EKS cluster for running the Spring PetClinic microservices",
      "interfaces": [
        {
          "interface_type": "api",
          "endpoint_pattern": "eks.${region}.amazonaws.com",
          "operations": ["DescribeCluster"],
          "authentication": "IAM"
        }
      ],
      "configuration": {
        "service_account": "visits-service-account"
      },
      "provider_type": "external"
    }
  ],
  "application_consumers": [
    {
      "consumer_id": "customers_service",
      "component_type": "microservice",
      "file_path": "spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/CustomersServiceApplication.java",
      "language": "Java",
      "description": "Customers service handling pet owner and pet information, with AWS service integrations",
      "resource_discovery": {
        "method": "environment variables",
        "environment_variables": ["AWS_REGION", "AWS_WEB_IDENTITY_TOKEN_FILE", "REGION_FROM_ECS"]
      },
      "authentication": {
        "method": "IAM role",
        "role_references": ["WebIdentityTokenFileCredentialsProvider", "DefaultCredentialsProvider"]
      },
      "sdk_usage": {
        "sdk_type": "AWS SDK for Java v2",
        "clients": ["KinesisClient", "SqsClient", "AmazonBedrockRuntime"]
      },
      "package_dependencies": [
        "software.amazon.awssdk:kinesis",
        "software.amazon.awssdk:sqs",
        "software.amazon.awssdk:auth",
        "com.amazonaws:aws-java-sdk-bedrock"
      ],
      "internal_dependencies": [
        {
          "resource_type": "Kinesis",
          "resource_name": "apm_test",
          "file_path": "spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/aws/KinesisService.java"
        },
        {
          "resource_type": "SQS",
          "resource_name": "apm_test",
          "file_path": "spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/aws/SqsService.java"
        }
      ],
      "external_dependencies": [
        {
          "resource_type": "Bedrock",
          "resource_name": "amazon.titan-text-express-v1",
          "repository": "external-ai-models"
        },
        {
          "resource_type": "Bedrock",
          "resource_name": "anthropic.claude-3-sonnet-20240229-v1:0",
          "repository": "external-ai-models"
        }
      ]
    },
    {
      "consumer_id": "vets_service",
      "component_type": "microservice",
      "file_path": "spring-petclinic-vets-service/src/main/java/org/springframework/samples/petclinic/vets/VetsServiceApplication.java",
      "language": "Java",
      "description": "Vets service providing veterinary professional information and S3 interaction",
      "resource_discovery": {
        "method": "environment variables",
        "environment_variables": ["AWS_WEB_IDENTITY_TOKEN_FILE", "TRACE_DATA_BUCKET", "TRACE_DATA_S3_KEY"]
      },
      "authentication": {
        "method": "IAM role",
        "role_references": ["WebIdentityTokenFileCredentialsProvider", "DefaultCredentialsProvider"]
      },
      "sdk_usage": {
        "sdk_type": "AWS SDK for Java v2",
        "clients": ["S3Client"]
      },
      "package_dependencies": [
        "software.amazon.awssdk:s3",
        "software.amazon.awssdk:auth"
      ],
      "internal_dependencies": [],
      "external_dependencies": [
        {
          "resource_type": "S3",
          "resource_name": "${trace_data_bucket}",
          "repository": "monitoring-infrastructure"
        }
      ]
    },
    {
      "consumer_id": "visits_service",
      "component_type": "microservice",
      "file_path": "spring-petclinic-visits-service/src/main/java/org/springframework/samples/petclinic/visits/VisitsServiceApplication.java",
      "language": "Java",
      "description": "Visits service for managing pet visit records with DynamoDB integration",
      "resource_discovery": {
        "method": "environment variables",
        "environment_variables": ["AWS_REGION", "AWS_WEB_IDENTITY_TOKEN_FILE", "REGION_FROM_ECS"]
      },
      "authentication": {
        "method": "IAM role",
        "role_references": ["WebIdentityTokenFileCredentialsProvider", "DefaultCredentialsProvider"]
      },
      "sdk_usage": {
        "sdk_type": "AWS SDK for Java v2",
        "clients": ["DynamoDbClient", "DynamoDbEnhancedClient"]
      },
      "package_dependencies": [
        "software.amazon.awssdk:dynamodb",
        "software.amazon.awssdk:dynamodb-enhanced",
        "software.amazon.awssdk:auth"
      ],
      "internal_dependencies": [
        {
          "resource_type": "DynamoDB",
          "resource_name": "apm_test",
          "file_path": "spring-petclinic-visits-service/src/main/java/org/springframework/samples/petclinic/visits/aws/DdbService.java"
        }
      ]
    },
    {
      "consumer_id": "pet_resource",
      "component_type": "controller",
      "file_path": "spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/web/PetResource.java",
      "language": "Java",
      "description": "REST controller for pet management that uses AWS services for enhanced functionality",
      "resource_discovery": {
        "method": "dependency injection"
      },
      "authentication": {
        "method": "inherited"
      },
      "sdk_usage": {
        "sdk_type": "inherited"
      },
      "package_dependencies": [],
      "internal_dependencies": [
        {
          "resource_type": "SQS",
          "resource_name": "apm_test",
          "file_path": "spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/aws/SqsService.java"
        },
        {
          "resource_type": "Kinesis",
          "resource_name": "apm_test",
          "file_path": "spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/aws/KinesisService.java"
        },
        {
          "resource_type": "Bedrock",
          "resource_name": "amazon.titan-text-express-v1",
          "file_path": "spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/aws/BedrockRuntimeV1Service.java"
        }
      ]
    },
    {
      "consumer_id": "visit_resource",
      "component_type": "controller",
      "file_path": "spring-petclinic-visits-service/src/main/java/org/springframework/samples/petclinic/visits/web/VisitResource.java",
      "language": "Java",
      "description": "REST controller for managing pet visit records that uses DynamoDB",
      "resource_discovery": {
        "method": "dependency injection"
      },
      "authentication": {
        "method": "inherited"
      },
      "sdk_usage": {
        "sdk_type": "inherited"
      },
      "package_dependencies": [],
      "internal_dependencies": [
        {
          "resource_type": "DynamoDB",
          "resource_name": "apm_test",
          "file_path": "spring-petclinic-visits-service/src/main/java/org/springframework/samples/petclinic/visits/aws/DdbService.java"
        }
      ]
    },
    {
      "consumer_id": "vet_resource",
      "component_type": "controller",
      "file_path": "spring-petclinic-vets-service/src/main/java/org/springframework/samples/petclinic/vets/web/VetResource.java",
      "language": "Java",
      "description": "REST controller for veterinary professional information that interacts with S3",
      "resource_discovery": {
        "method": "dependency injection"
      },
      "authentication": {
        "method": "inherited"
      },
      "sdk_usage": {
        "sdk_type": "inherited"
      },
      "package_dependencies": [],
      "internal_dependencies": [
        {
          "resource_type": "S3",
          "resource_name": "${trace_data_bucket}",
          "file_path": "spring-petclinic-vets-service/src/main/java/org/springframework/samples/petclinic/vets/aws/S3Service.java"
        }
      ]
    }
  ],
  "connections": [
    {
      "connection_id": "pet_resource_to_sqs",
      "consumer_id": "pet_resource",
      "provider_id": "sqs_queue",
      "provider_resource_type": "SQS",
      "operation": "sendMessage",
      "access_type": "write",
      "description": "Sends a message to SQS when a new pet is created",
      "code_snippet": "sqsService.sendMsg();",
      "source_file_path": "spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/web/PetResource.java",
      "target_file_path": "spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/aws/SqsService.java",
      "configuration_source": "service injection",
      "criticality": "medium",
      "connection_type": "direct",
      "cross_repo": false
    },
    {
      "connection_id": "pet_resource_to_kinesis",
      "consumer_id": "pet_resource",
      "provider_id": "kinesis_data_stream",
      "provider_resource_type": "Kinesis",
      "operation": "getRecords",
      "access_type": "read",
      "description": "Retrieves stream records from Kinesis when a pet is updated",
      "code_snippet": "kinesisService.getStreamRecords();",
      "source_file_path": "spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/web/PetResource.java",
      "target_file_path": "spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/aws/KinesisService.java",
      "configuration_source": "service injection",
      "criticality": "medium",
      "connection_type": "direct",
      "cross_repo": false
    },
    {
      "connection_id": "pet_resource_to_bedrock_agent",
      "consumer_id": "pet_resource",
      "provider_id": "bedrock_kb",
      "provider_resource_type": "Bedrock",
      "operation": "getKnowledgeBase",
      "access_type": "read",
      "description": "Accesses Bedrock knowledge base for pet diagnosis",
      "code_snippet": "bedrockAgentV1Service.getKnowledgeBase();",
      "source_file_path": "spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/web/PetResource.java",
      "target_file_path": "spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/aws/BedrockAgentV1Service.java",
      "configuration_source": "service injection",
      "criticality": "medium",
      "connection_type": "direct",
      "cross_repo": true,
      "target_repo": "external-ai-models"
    },
    {
      "connection_id": "pet_resource_to_bedrock_guardrails",
      "consumer_id": "pet_resource",
      "provider_id": "bedrock_guardrails",
      "provider_resource_type": "Bedrock",
      "operation": "getGuardrail",
      "access_type": "read",
      "description": "Accesses Bedrock guardrails for content moderation",
      "code_snippet": "bedrockV1Service.getGuardrail();",
      "source_file_path": "spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/web/PetResource.java",
      "target_file_path": "spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/aws/BedrockV1Service.java",
      "configuration_source": "service injection",
      "criticality": "medium",
      "connection_type": "direct",
      "cross_repo": true,
      "target_repo": "external-ai-models"
    },
    {
      "connection_id": "pet_resource_to_bedrock_titan",
      "consumer_id": "pet_resource",
      "provider_id": "bedrock_runtime",
      "provider_resource_type": "Bedrock",
      "operation": "invokeModel",
      "access_type": "read",
      "description": "Invokes Titan AI model to get information about pet diseases",
      "code_snippet": "bedrockRuntimeV1Service.invokeTitanModel(petType);",
      "source_file_path": "spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/web/PetResource.java",
      "target_file_path": "spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/aws/BedrockRuntimeV1Service.java",
      "configuration_source": "service injection",
      "criticality": "medium",
      "connection_type": "direct",
      "cross_repo": true,
      "target_repo": "external-ai-models"
    },
    {
      "connection_id": "pet_resource_to_bedrock_claude",
      "consumer_id": "pet_resource",
      "provider_id": "bedrock_runtime_claude",
      "provider_resource_type": "Bedrock",
      "operation": "invokeModel",
      "access_type": "read",
      "description": "Invokes Claude AI model to get information about pet health",
      "code_snippet": "bedrockRuntimeV2Service.invokeAnthropicClaude(petType);",
      "source_file_path": "spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/web/PetResource.java",
      "target_file_path": "spring-petclinic-customers-service/src/main/java/org/springframework/samples/petclinic/customers/aws/BedrockRuntimeV2Service.java",
      "configuration_source": "service injection",
      "criticality": "medium",
      "connection_type": "direct",
      "cross_repo": true,
      "target_repo": "external-ai-models"
    },
    {
      "connection_id": "visit_resource_to_dynamodb",
      "consumer_id": "visit_resource",
      "provider_id": "dynamodb_table",
      "provider_resource_type": "DynamoDB",
      "operation": "putItem",
      "access_type": "write",
      "description": "Stores visit monitoring data in DynamoDB when a new visit is created",
      "code_snippet": "ddbService.putItems();",
      "source_file_path": "spring-petclinic-visits-service/src/main/java/org/springframework/samples/petclinic/visits/web/VisitResource.java",
      "target_file_path": "spring-petclinic-visits-service/src/main/java/org/springframework/samples/petclinic/visits/aws/DdbService.java",
      "configuration_source": "service injection",
      "criticality": "medium",
      "connection_type": "direct",
      "cross_repo": false
    },
    {
      "connection_id": "vet_resource_to_s3",
      "consumer_id": "vet_resource",
      "provider_id": "s3_bucket",
      "provider_resource_type": "S3",
      "operation": "listBuckets",
      "access_type": "read",
      "description": "Lists S3 buckets when retrieving veterinarian information",
      "code_snippet": "s3Service.listBuckets();",
      "source_file_path": "spring-petclinic-vets-service/src/main/java/org/springframework/samples/petclinic/vets/web/VetResource.java",
      "target_file_path": "spring-petclinic-vets-service/src/main/java/org/springframework/samples/petclinic/vets/aws/S3Service.java",
      "configuration_source": "service injection",
      "criticality": "low",
      "connection_type": "direct",
      "cross_repo": true,
      "target_repo": "monitoring-infrastructure"
    }
  ],
  "architecture": {
    "application_type": "microservice",
    "infrastructure_pattern": "container-based",
    "deployment_approach": "Kubernetes on EKS",
    "configuration_management": "Spring application properties with environment variables for AWS resource configuration",
    "critical_paths": [
      {
        "name": "pet_management",
        "description": "Pet creation and management flow with AWS integrations",
        "components": ["customers_service", "pet_resource", "sqs_queue", "kinesis_data_stream"]
      },
      {
        "name": "pet_diagnosis",
        "description": "AI-powered pet diagnosis using Bedrock models",
        "components": ["customers_service", "pet_resource", "bedrock_runtime", "bedrock_runtime_claude", "bedrock_kb"]
      },
      {
        "name": "visit_tracking",
        "description": "Pet visit recording with DynamoDB storage",
        "components": ["visits_service", "visit_resource", "dynamodb_table"]
      }
    ],
    "security_model": {
      "authentication": "IAM roles via WebIdentityToken for EKS pods",
      "authorization": "IAM policies attached to service accounts",
      "service_account_integration": "EKS IRSA (IAM Roles for Service Accounts)"
    },
    "cross_repo_dependencies": {
      "provides_to": [],
      "consumes_from": [
        {"repository": "external-ai-models", "resources": ["bedrock_runtime", "bedrock_runtime_claude", "bedrock_kb", "bedrock_guardrails"]},
        {"repository": "monitoring-infrastructure", "resources": ["s3_bucket"]}
      ],
      "shared_infrastructure": true
    }
  }
}